const SHEET_ID = "TU_SHEET_ID"; // Reemplázalo con tu ID de Google Sheet
const API_URL = `https://script.google.com/macros/s/TU_SCRIPT_ID/exec`; // Reemplázalo con el ID del script de Google Apps Script

function cargarMisAlquileres() {
    const propietarioID = document.getElementById("propietario-id").value;
    if (!propietarioID) {
        alert("Ingresa tu ID de propietario.");
        return;
    }

    fetch(`${API_URL}?accion=obtener&propietarioID=${propietarioID}`)
        .then(response => response.json())
        .then(data => {
            const lista = document.getElementById("alquileres-lista");
            lista.innerHTML = "";

            if (data.length === 0) {
                lista.innerHTML = "<p>No se encontraron alquileres.</p>";
                return;
            }

            data.forEach(alquiler => {
                const alquilerItem = document.createElement("div");
                alquilerItem.classList.add("alquiler-item");

                let estadoColor = alquiler.estado === "Activo" ? "green" : "red";
                let estadoTexto = alquiler.estado === "Activo" ? "Desactivar" : "Activar";

                alquilerItem.innerHTML = `
                    <p><strong>Dirección:</strong> <span class="dato">${alquiler.direccion}</span> <input type="text" class="editar-input" style="display:none;"></p>
                    <p><strong>Ambientes:</strong> <span class="dato">${alquiler.ambientes}</span> <input type="text" class="editar-input" style="display:none;"></p>
                    <p><strong>Precio:</strong> $<span class="dato">${alquiler.precio}</span> <input type="text" class="editar-input" style="display:none;"></p>
                    <p><strong>Permite Mascotas:</strong> <span class="dato">${alquiler.permite_mascotas}</span> <input type="text" class="editar-input" style="display:none;"></p>
                    <div class="botones">
                        <button class="editar-btn" onclick="editarAlquiler(this)">Editar</button>
                        <button class="guardar-btn" onclick="guardarCambios(this, '${alquiler.id}')" style="display:none;">Guardar Cambios</button>
                        <button class="eliminar-btn" onclick="eliminarAlquiler('${alquiler.id}')">Eliminar</button>
                        <button class="estado-btn" style="background-color: ${estadoColor}; color: white;" onclick="cambiarEstado('${alquiler.id}', this)">
                            ${estadoTexto}
                        </button>
                    </div>
                `;
                lista.appendChild(alquilerItem);
            });
        })
        .catch(error => console.error("Error al obtener alquileres:", error));
}

function editarAlquiler(btn) {
    let alquilerItem = btn.closest(".alquiler-item");
    let datos = alquilerItem.querySelectorAll(".dato");
    let inputs = alquilerItem.querySelectorAll(".editar-input");
    let guardarBtn = alquilerItem.querySelector(".guardar-btn");

    datos.forEach((dato, index) => {
        inputs[index].value = dato.textContent;
        dato.style.display = "none";
        inputs[index].style.display = "inline-block";
    });

    btn.style.display = "none"; 
    guardarBtn.style.display = "inline-block";
}

function guardarCambios(btn, id) {
    let alquilerItem = btn.closest(".alquiler-item");
    let datos = alquilerItem.querySelectorAll(".dato");
    let inputs = alquilerItem.querySelectorAll(".editar-input");
    let editarBtn = alquilerItem.querySelector(".editar-btn");

    let nuevosDatos = {
        id: id,
        direccion: inputs[0].value,
        ambientes: inputs[1].value,
        precio: inputs[2].value,
        permite_mascotas: inputs[3].value
    };

    fetch(`${API_URL}?accion=editar`, {
        method: "POST",
        body: JSON.stringify(nuevosDatos),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(response => {
        if (response.success) {
            datos.forEach((dato, index) => {
                dato.textContent = inputs[index].value;
                dato.style.display = "inline";
                inputs[index].style.display = "none";
            });

            btn.style.display = "none";
            editarBtn.style.display = "inline-block";
        } else {
            alert("Error al actualizar el alquiler.");
        }
    })
    .catch(error => console.error("Error al guardar cambios:", error));
}

function eliminarAlquiler(id) {
    if (!confirm("¿Seguro que quieres eliminar este alquiler?")) return;

    fetch(`${API_URL}?accion=eliminar&id=${id}`)
        .then(response => response.json())
        .then(response => {
            if (response.success) {
                cargarMisAlquileres();
            } else {
                alert("Error al eliminar el alquiler.");
            }
        })
        .catch(error => console.error("Error al eliminar alquiler:", error));
}

function cambiarEstado(id, btn) {
    let nuevoEstado = btn.textContent === "Desactivar" ? "Inactivo" : "Activo";

    fetch(`${API_URL}?accion=cambiarEstado&id=${id}&estado=${nuevoEstado}`)
        .then(response => response.json())
        .then(response => {
            if (response.success) {
                btn.textContent = nuevoEstado === "Activo" ? "Desactivar" : "Activar";
                btn.style.backgroundColor = nuevoEstado === "Activo" ? "green" : "red";
            } else {
                alert("Error al cambiar estado.");
            }
        })
        .catch(error => console.error("Error al cambiar estado:", error));
}
