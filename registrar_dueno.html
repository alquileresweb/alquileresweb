function handleRequest(e) {
  const action = e.parameter.action;

  // CORS HEADERS
  const corsHeaders = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'POST, GET, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type'
  };

  // Manejo OPTIONS (preflight)
  if (e.postData === undefined && e.parameter.action === undefined) {
    return ContentService.createTextOutput('ok').setMimeType(ContentService.MimeType.TEXT);
  }

  // FUNCIONES
  let respuesta = "";

  if (action == "registrarDueno") {
    const nombre = e.parameter.nombre;
    const email = e.parameter.email;
    const telefono = e.parameter.telefono;
    respuesta = registrarDueno(nombre, email, telefono);
  }

  else if (action == "verificarLogin") {
    const idUnico = e.parameter.idUnico;
    respuesta = verificarInicioSesion(idUnico);
  }

  else if (action == "agregarAlquiler") {
    const direccion = e.parameter.direccion;
    const ambientes = e.parameter.ambientes;
    const precio = e.parameter.precio;
    const mascotas = e.parameter.mascotas;
    const estado = e.parameter.estado;
    const idPropietario = e.parameter.idPropietario;
    const whatsApp = e.parameter.whatsApp;
    const latitud = e.parameter.latitud;
    const longitud = e.parameter.longitud;

    agregarAlquiler(direccion, ambientes, precio, mascotas, estado, idPropietario, whatsApp, latitud, longitud);
    respuesta = JSON.stringify({ resultado: "ok" });
  }

  else if (action == "obtenerMisAlquileres") {
    const idPropietario = e.parameter.idPropietario;
    const alquileres = obtenerMisAlquileres(idPropietario);
    respuesta = JSON.stringify(alquileres);
  }

  else if (action == "eliminarAlquiler") {
    const idAlquiler = e.parameter.idAlquiler;
    eliminarAlquiler(idAlquiler);
    respuesta = JSON.stringify({ eliminado: true });
  }

  else if (action == "editarAlquiler") {
    const idAlquiler = e.parameter.idAlquiler;
    const direccion = e.parameter.direccion;
    const ambientes = e.parameter.ambientes;
    const precio = e.parameter.precio;
    const mascotas = e.parameter.mascotas;
    const estado = e.parameter.estado;
    const whatsApp = e.parameter.whatsApp;
    const latitud = e.parameter.latitud;
    const longitud = e.parameter.longitud;

    editarAlquiler(idAlquiler, direccion, ambientes, precio, mascotas, estado, whatsApp, latitud, longitud);
    respuesta = JSON.stringify({ editado: true });
  }

  else {
    respuesta = JSON.stringify({ error: "Acción no válida" });
  }

  // DEVOLVER RESPUESTA CON HEADERS
  return HtmlService.createHtmlOutput(respuesta)
    .setMimeType(ContentService.MimeType.JSON)
    .appendUntrustedContent("")
    .getResponse()
    .setHeaders(corsHeaders);
}
